language: php

{% if runOnDocker %}
sudo: false

## Cache composer bits
cache:
directories:
- vendor
- $HOME/.composer/cache
{% endif %}

## PHP versions we test against
php:{% for version in versions %}
  - {{ version }}
{% endfor %}

## Build matrix for lowest and highest possible targets
matrix:
  include:{% for version in versions %}
    - php: {{ version }}
      env: dependencies=lowest
    - php: {{ version }}
      env: dependencies=highest
{% endfor %}
{% if version|length > 0 %}
  allow_failures:{% for version in allowFailures %}
    - php: {{ version }}
{% endfor %}
{% endif %}

before_script:
- composer self-update
- if [ -z "$dependencies" ]; then composer install; fi;
- if [ "$dependencies" = "lowest" ]; then composer update --prefer-lowest --prefer-stable -n; fi;
- if [ "$dependencies" = "highest" ]; then composer update --prefer-stable -n; fi;
- composer show -i

## Run the actual test
script: make travis

## Send coverage report to scrutinizer
after_script: make travis-coverage
